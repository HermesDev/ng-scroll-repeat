angular.module("ks.ngScrollRepeat",["ks.WindowService"]).directive("ngScrollRepeat",["$compile","WindowService",function(e,r){"use strict";var t=50,i=200,n=function(e){if(e.match(/limitTo/)||e.match(/startFrom/))throw new Error('"limitTo" and "startFrom" filters are not allowed in scroll-repeat directive')},o=function(e){var t=r.height(),i=e.offset().top-r.scrollTop()+e.height();return i-t},l=function(l,c){var a=c.ngScrollRepeat,s=a.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),u=s[2],p=c.pageSize?Number(c.pageSize):t,f=c.tolerance?Number(c.tolerance):i;return n(a),l.removeAttr("ng-scroll-repeat"),l.attr("ng-repeat",a+" | limitTo:visibleResults"),function(t,i){var n;t.visibleResults=p,e(i)(t),t.$watch(u,function(e){n=e.length},!0);var l=$(i[0]).parent();r.registerForScroll(t),t.$on(r.WINDOW_SCROLL,function(){var e=o(l);f>=e&&n>t.visibleResults&&(t.visibleResults+=p)})}};return{replace:!1,terminal:!0,priority:2e3,restrict:"A",compile:l}}]),angular.module("ks.WindowService",[]).factory("WindowService",["$window",function(e){var r=angular.element(e),t="WINDOW_SCROLL",i=function(e,r){e.$$phase||e.$root.$$phase?r():e.$apply(r)};return{WINDOW_SCROLL:t,height:function(){return r.height()},scrollTop:function(){return r.scrollTop()},registerForScroll:function(e){r.on("scroll",function(){i(e,function(){e.$broadcast(t)})})}}}]);