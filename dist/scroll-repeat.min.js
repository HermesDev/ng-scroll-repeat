angular.module("ks.scrollRepeat",["ks-window-service"]).directive("scrollRepeat",["$compile","WindowService",function(e,r){"use strict";var t=50,o=200,i=function(e){if(e.match(/limitTo/)||e.match(/startFrom/))throw new Error('"limitTo" and "startFrom" filters are not allowed in scroll-repeat directive')},n=function(e){var t=r.height(),o=e.offset().top-r.scrollTop()+e.height();return o-t},l=function(l,s){var c=s.scrollRepeat,a=c.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),u=a[2],p=s.pageSize?Number(s.pageSize):t,f=s.tolerance?Number(s.tolerance):o;return i(c),l.removeAttr("scroll-repeat"),l.attr("ng-repeat",s.scrollRepeat+" | limitTo:visibleResults"),function(t,o){var i;t.visibleResults=p,e(o)(t),t.$watch(u,function(e){i=e.length},!0);var l=$(o[0]).parent();r.registerForScroll(t),t.$on(r.WINDOW_SCROLL,function(){var e=n(l);f>=e&&i>t.visibleResults&&(t.visibleResults+=p)})}};return{replace:!1,terminal:!0,priority:2e3,restrict:"A",compile:l}}]),angular.module("ks-window-service",[]).factory("WindowService",["$window",function(e){var r=angular.element(e),t="WINDOW_SCROLL",o=function(e,r){e.$$phase||e.$root.$$phase?r():e.$apply(r)};return{WINDOW_SCROLL:t,height:function(){return r.height()},scrollTop:function(){return r.scrollTop()},registerForScroll:function(e){r.on("scroll",function(){o(e,function(){e.$broadcast(t)})})}}}]);